<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>SFV JUMP LOL</title>
<style>

  body {
    background-color: #000;
    color: #fff;
    font-family: sans-serif;
    /*margin-bottom: 500px;*/
    width: 2500px;
  }

  line {
    stroke-width: 1px;
    stroke: #999;
    fill: #ddd;
    vector-effect: non-scaling-stroke;
  }


  rect {
    stroke-width: 1px;
    stroke: #999;
    fill: none;
    vector-effect: non-scaling-stroke;
  }

  #STAGE rect.HURT {
    opacity: 0.2;
  }

  #STAGE rect.GRAB {
    opacity: 0.2;
  }

  #STAGE rect.PROJINV {
    opacity: 0.2;
  }

  rect.HURT {
    stroke-width: 1px;
    stroke: #090;
    fill: none;
    vector-effect: non-scaling-stroke;
    mix-blend-mode: screen;
  }

  rect.PROJINV {
    stroke-width: 1px;
    stroke: #960;
    fill: none;
    vector-effect: non-scaling-stroke;
    mix-blend-mode: screen;
  }

  rect.GRAB {
    stroke-width: 1px;
    stroke: #009;
    fill: none;
    vector-effect: non-scaling-stroke;
    mix-blend-mode: screen;
  }

  rect.HIT {
    stroke-width: 1px;
    stroke: #900;
    fill: none;
    vector-effect: non-scaling-stroke;
    mix-blend-mode: screen;
  }

  path {
    stroke-width: 1px;
    stroke: #333;
    fill: #ddd;
    vector-effect: non-scaling-stroke;
  }

  a {
    color: #0079d3;
  }

  .GRID line {
    vector-effect: non-scaling-stroke;
  }

  .REPLAY line {
    vector-effect: non-scaling-stroke;
  }

  .UNOC { display: none; }

  .fred { fill: #c00 !important; }

  .gray { stroke: #333; }
  .red { stroke: #f00; }
  .green { stroke: #0f0; }
  .blue { stroke: #00f; }
  .cyan { stroke: #0ff; }
  .yellow { stroke: #ff0; }

  .p1gray { stroke: #333; }
  .p1red { stroke: #f00; }
  .p1green { stroke: #0f0; }
  .p1blue { stroke: #00f; }
  .p1hit { stroke: #c6f; }
  .p1cyan { stroke: #0ff; }
  .p1yellow { stroke: #ff0; }

  .p2gray { stroke: #333; }
  .p2red { stroke: #f66; }
  .p2green { stroke: #6f6; }
  .p2blue { stroke: #66f; }
  .p2hit { stroke: #c6f; }
  .p2cyan { stroke: #6ff; }

  .hitbox { color: #f99; }
  .hit { color: #969; }
  .first { color: #cfc; background-color: #363;}
  .iasa1 { color: #999;}

  #REPLAYS {
    text-align: center;
    /*display: inline-block;*/
  }

  #REPLAYS  !svg + div {
    /*display: inline-block;*/
  }

  #REPLAYS div {
    height: 500px;
    overflow-x: hidden;
    overflow-y: auto;
    display: inline-block;
    padding-right: 2em;
  }

  #LINKS {
    /*height: 500px;*/
    white-space: nowrap;
    overflow: auto;
  }

  #FRAMES, #KD, #TOTALS {
    white-space: nowrap;
    /*height: 500px;*/
    /*overflow-x: hidden;*/
    /*overflow-y: auto;*/
    /*display: inline-block;*/
    /*padding-right: 2em;*/
  }

  #FRAMES div {
    display: inline-block;
    vertical-align: top;
  }

  table.FRAMES {
    table-layout: fixed;
    font: 10px sans-serif;
    text-align: center;
    color: #ccc;
  }

  table.FRAMES thead tr {
    background-color: #030; 
  }

  table.FRAMES tbody tr:nth-child(even) {
    background-color: #333; 
  }

  table.FRAMES tbody tr:nth-child(odd) {
    background-color: #111;
  }

 table.FRAMES tbody tr td:nth-child(3) {
    color: #9cc;
  }
 table.FRAMES tbody tr td:nth-child(4) {
    color: #c99;
  }
  table.FRAMES td {
    white-space: nowrap;
    padding: 2px;
  }

  table.FRAMES th {
    white-space: nowrap;
    padding: 2px;
    cursor: s-resize;
  }
  
  table.FRAMES tr {
    white-space: nowrap;
    padding: 2px;
    cursor: pointer;
  }

  table.FRAMES tbody tr.UC {
    background-color: #060 !important;
  }

  table.FRAMES tbody tr:hover {
    background-color: #060 !important;
  }

  table.FRAMES tbody tr:nth-child(even).UC0 {  
    background-color: #030;
  }
  table.FRAMES tbody tr:nth-child(odd).UC0 {
    background-color: #030;
  }

  table.FRAMES tbody tr.UC1 {  
    background-color: #030;
  }

  #LINKS div.COL {
    display: inline-block;
    vertical-align: top;
  }

  #LINKS div.COL div {
    text-align: left;
    padding: 10px;
  }

  #LINKS button {
    background-color: #ccc;
    padding: 10px 10px;
  }

  svg {
    /*border: 1px solid #111;*/
    /*margin-top: 10px;*/
  }

  .REPLAY rect {
    stroke-width: 1px;
    /*stroke: #333;*/
    fill: none;
    /*opacity: 0.8;*/
    mix-blend-mode: screen;
    vector-effect: non-scaling-stroke;
  }

  .REPLAY rect.clip {
    fill: #330;
  }

  .REPLAY text {
    text-anchor: middle;
    fill: #999;
    font: 8px sans-serif;
  }

  .rects text {
    text-anchor: middle;
    fill: #999;
    font: 10px sans-serif;
  }

  .axis {
    font: 10px sans-serif;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }

  .axis text {
    fill: #ddd;
  }

  .axis .domain {
    fill: none;
    stroke: #000;
    stroke-opacity: .3;
    stroke-width: 10px;
    stroke-linecap: round;
  }

  .axis .halo {
    fill: none;
    stroke: #ddd;
    stroke-width: 8px;
    stroke-linecap: round;
  }

  .slider .handle {
    fill: #fff;
    fill-opacity: .75;
    stroke: #000;
    stroke-opacity: .5;
    stroke-width: 1.25px;
    cursor: crosshair;
  }

  #OKI > span.GRID {
    color: #ccc;
  }

  .GRID > span:nth-child(10n) {
    color: #eee;
  }


  .GRID > span.ACTIVE {
    color: #fcc;
  }

  .GRID > span.STARTUP {
    color: #aaa;
  }

  .GRID > span.RECOVERY {
    color: #aaa;
  }

  .GRID > span.WAKEUP {
    color: #cfc;
  }

  .GRID > span.FK {
    color: #ccc;
  }


  .UCLICK:hover {
    color: #fff;
    background-color: #990;
    cursor: pointer;
  }

  button.CHAR {
    padding: 5px;
    margin: 3px;
    /*width: 8%;*/
    background-color: #999;
  }

  button.SEL {
    background-color: #ffc;
  }

  #OKI {    
    cursor: pointer;
  }

  .CMD {
    color: #999;
  }

  .UCY1 {    
    background-color: #033;
  }

  .UCY2 {    
    background-color: #033;
  }

  .UCY3 {    
    background-color: #220;
  }

  .UCY4 {    
    background-color: #220;
  }

  .UCY5 {    
    background-color: #220;
  }

  .UCY6 {    
    background-color: #220;
  }

  .UCY7 {    
    background-color: #220;
  }


  .UCOKI {
    background-color: #020;
  }

  #FRAMEKILLS {
    line-height: 1.5em;
  }

  .FRAMEKILL {
    color: #999;
  }

  button.CHARRESET {
    margin-left: 50px;
  }

  #JUMPJUMP, #JUMP, #STAND, #JUMPZIP, #STANDZIP {
    display: inline-block;
    max-height: 95vh;
    /*overflow-y: scroll;*/
    vertical-align: top;

  } 

  #FRAMES, #FRAMES2 {    
    display: inline-block;
    max-height: 95vh;
    /*overflow-y: scroll;*/
    vertical-align: top;
    /*text-align: right;*/
    /*position: fixed;*/
    /*width: 99%;*/
    /*z-index: -100;*/
  }

  #VIEW, #MAIN {
    display: inline-block;
    /*max-height: 95vh;*/
    overflow-y: auto;
    overflow-x: hidden;
    vertical-align: top;
    /*text-align: right;*/
    /*position: fixed;*/
    /*width: 99%;*/
    /*z-index: -100;*/
    white-space: nowrap;
    /*width: 1000px;*/
  }

</style>

</head>
<body>
<div id="JUMPZIP">
<table class="FRAMES"><thead><tr><th>#</th><th>JUMP</th></tr></thead><tbody><tr><td>7 MB</td><td>LOADING...</td></tr></tbody></table>
<br/>
<table class="FRAMES">
<thead><tr><th id="LOADJUMP">LOAD</th></tr></thead><tbody><tr><td onclick="ALLSTAND(); ALLJUMP();">ALL</td></tr><tr><td onclick="ALLJUMP();">ALL JUMP</td></tr><tr><td id="ALLLOAD">&nbsp;</td></tr><tr><td onclick="ALLSTAND();">ALL STAND</td></tr><tr><td id="ALLLOADSTAND">&nbsp;</td></tr></tbody>
<thead><tr><th>LOL</th></tr></thead><tbody><tr><td>U CLICK</td></tr><tr><td>U C HIT BOX</td></tr><tr><td>U HOLD SHIFT</td></tr><tr><td>U HOVER</td></tr><tr><td>U SCROLL</td></tr><tr><td>U ZOOM</td></tr><tr><td>U PINCH</td></tr><tr><td>U ZOOM</td></tr><tr><td>&nbsp;</td></tr></tbody>
<thead><tr><th>TOGGLE</th></tr></thead><tbody><tr onclick="TOGGLESTAGE();"><td>TOP STAGE</td></tr><tr class="UC" onclick="JUMPHIT=!JUMPHIT;d3.select(this).classed('UC',JUMPHIT)"><td>JUMP HIT</td></tr><tr class="UC" onclick="STANDHIT=!STANDHIT;d3.select(this).classed('UC',STANDHIT)"><td>STAND HIT</td></tr></tbody></table>
</div>
<div id="JUMPJUMP"></div>
<div id="JUMP"></div>
<div id="FRAMES"><table class="FRAMES"><thead><tr><th>#</th><th>SCRIPT</th><th>X1</th><th>X2</th><th>X3</th><th>F1</th><th>P1</th><th>P2</th><th>F2</th></tr></thead><tbody><tr><td>&lt;</td><td>U CLICK</td></tr><tr><td>&lt;</td><td>U C</td></tr></tbody></table></div>
<div id="MAIN">
<div id="VIEW">
<div><svg id="STAGE" width="640" height="500"><g id="G00"><g id="G0" transform="translate(320 500)scale(100)"><g id="G"></g><g id="GG"></g><line x1="-2" y1="0" x2="+2" y2="0"></line></g></g></svg></div>
<div><svg id="STAGE1" width="640" height="500"><g id="GG00"><g id="GG0" transform="translate(320 500)scale(100)"><g id="G1"></g><g id="GG1"></g><line x1="-2" y1="0" x2="+2" y2="0"></line></g></g></svg></div>
<div></div></div>
</div>
<div id="STANDZIP"><table class="FRAMES"><thead><tr><th>#</th><th>STAND</th></tr></thead><tbody><tr><td>4 MB</td><td>LOADING...</td></tr></tbody></table></div>
<div id="STAND"></div>
<div id="FRAMES2"><table class="FRAMES"><thead><tr><th>#</th><th>SCRIPT</th><th>X1</th><th>X2</th><th>X3</th><th>DATA</th></tr></thead><tbody><tr><td>&lt;</td><td>U CLICK</td></tr><tr><td>&lt;</td><td>U C</td></tr></tbody></table></div>
<script src="d3.v4.min.js"></script>
<script src="jszip.min.js"></script>
<script type="text/javascript" src="jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="jszip-utils-ie.min.js"></script>
<![endif]-->
<script>
var zoom = d3.zoom()
    .scaleExtent([1, 2])
    .translateExtent([[0,0],[640,500]])
    .on("zoom", zoomed);

var zoom1 = d3.zoom()
    .scaleExtent([1, 2])
    .translateExtent([[0,0],[640,500]])
    .on("zoom", zoomed1);

function zoomed() {
  d3.select("#G00").attr("transform", d3.event.transform);
}

function zoomed1() {
  d3.select("#GG00").attr("transform", d3.event.transform);
}

// d3.select("#STAGE").call(zoom);
d3.select("#STAGE1").call(zoom1);
var JUMPZIP = d3.select("#JUMPZIP");
var STANDZIP = d3.select("#STANDZIP");
var JUMPJUMP = d3.select("#JUMPJUMP");
var JUMP = d3.select("#JUMP");
var STAND = d3.select("#STAND");
var STANDS = d3.select("#STANDS");
var JUMPS = [{},{},{},{}];
var JUMPSCRIPTS = [{},{},{}];
var JUMPFRAMES = [{},{},{}];
var FRAMES = d3.select("#FRAMES");
var FRAMES2 = d3.select("#FRAMES2");
var VIEW = d3.select("#VIEW");
var STAGE = d3.select("#STAGE");
var STAGE1 = d3.select("#STAGE1");
var G = d3.select("#G");
var GG = d3.select("#GG");
var G1 = d3.select("#G1");
var GG1 = d3.select("#GG1");
var JJ = {p:0,m:"9J",md:3,m2:"5LK",data:null};
var SS = {p:1,m:"5LP",data:null,x:2.0};
var I1 = 12;
var I2 = 25;
var JUMPHIT = true;
var STANDHIT = true;


function FOOTSIE(f1,f2,x1,x2) {
  for (var c1=0;c1<f1.c5.length;c1++) {
    var b1 = f1.c5[c1];
    if (b1.t!=4 && b1.t!=3) {      
      var r1 = {left:b1.rx+x1,top:b1.ry,right:b1.rx+x1+b1.rw,bottom:b1.ry+b1.rh};
      for (var c2=0;c2<f2.c6.length;c2++) {
        var b2 = f2.c6[c2];
        if ((b1.t == 2 && (b2.t & 4) == 4 && ((f2.c1 & 4) != 4)) || (b1.t == 0 && b2.t != 4
          
          && (((b1.i & 1) == 0) || ((b1.i & 1) == 1) && ((f2.c1 & 1) != 1))
          && (((b1.i & 2) == 0) || ((b1.i & 2) == 2) && ((f2.c1 & 2) != 2))
          && (((b1.i & 4) == 0) || ((b1.i & 4) == 4) && ((f2.c1 & 4) != 4))

          )) {          
          var r2 = {left:b2.rx+x2,top:b2.ry,right:b2.rx+x2+b2.rw,bottom:b2.ry+b2.rh};
          var hit = !(r2.left > r1.right || r2.right < r1.left || r2.top > r1.bottom || r2.bottom < r1.top);
          if (hit) return 1; //b1.t == 2 ? 1000 : b1.s;
        }
      }
    }
  }
  return 0;
}


function UCJUMPSTAND(jump,start) {
  if (SS.data == null) return ["","","",""];
  // console.log(jump.f[start],SS.data);

  var x1=0, x2=SS.x;
  var i=0;
  for (i=0;i<SS.data.f.length-2;i++) {

    if (start+i>=jump.f.length) break;
    var p1 = JUMPFRAMES[1][jump.f[start+i]];
    var p2 = SS.data.f[i+2];
    if (p2.sf>p2.s1) break;
    if (p1.si==0 && p1.sf==0) break;
    if (p1.si==0 && p1.sf==0) break;
    if (p1.si==6 && p1.sf>=2) break;
    if (p1.si==9 && p1.sf>=2) break;
    if (p1.si==3 || p2.si==3) break;
    
    var r1 = FOOTSIE(p1,p2,x1,x2);
    var r2 = FOOTSIE(p2,p1,x2,x1);

    if (r1 > 0 || r2 > 0) 
      return [//(start+i-1)
              p1.sf+1,(r1 > 0 ? "1" : ""),(r2 > 0 ? "2" : ""),(i+1)];
  }
  return ["","","",""];
}

function TOGGLESTAGE() {  
  var t1 = VIEW.selectAll("div")._groups[0][0];
  var t2 = VIEW.selectAll("div")._groups[0][1];
  var t0 = t1.parentNode;
  t0.insertBefore(t2,t1);
}

function JUMPROW(d,i) {return [d.p+1,d.m,d.md,d.m2];}
function STANDROW(d,i) {
  var START = d.f.findIndex(function(ff,ii){ return ff.c5.length>0; })-1;
  var IASA = d.f.findIndex(function(ff,ii){ return ff.sf==ff.s1; })-1;
  return [d.p+1,d.m, START == -2 ? "-" : START, IASA == -2 ? "-" : IASA];
}
function STANDALLROW(d,i) {
  var START = d.f.findIndex(function(ff,ii){ return ff.c5.length>0; })-1;
  var IASA = d.f.findIndex(function(ff,ii){ return ff.sf==ff.s1; })-1;
  var DIST = -d.f[START+1].c5[0].rx + 2.0;
  return [d.c,d.m, START == -2 ? "-" : START, IASA == -2 ? "-" : IASA, DIST.toFixed(4)];
}

function JUMPJUMPVIEW(d,i) {
  if (d3.event != null && d3.event.type == "mouseenter" && !d3.event.shiftKey && i>=0) return;

  JJ.p = d.p;
  JJ.m = d.m;
  JJ.md = d.md;
  JJ.m2 = d.m2;

  if (i>=0) {
    d3.select(this.parentNode).selectAll(".UC").classed("UC",false);
    d3.select(this).classed("UC",true);
  }

  if (JUMPHIT) {
    var hi = d.f.findIndex(function(ff,ii){ return JUMPFRAMES[1][ff].c5.length>0; });
    if (hi>-1) I1 = hi;
  }

  JJ.data = d;

  var TB = FRAMES.select("table").select("tbody");
  TB.selectAll("tr").remove();
  var TR = TB.selectAll("tr").data(d.f.map(function(dd){ return JUMPFRAMES[1][dd]; })).enter().append("tr").on("mouseenter",JUMPSTAGE1).on("click",JUMPSTAGE1).classed("UC",function(dd,ii){return ii==I1;});
  TR.selectAll("td")
      .data(function(dd,ii){ return [dd.i-1,JUMPSCRIPTS[1][dd.si].s + " " + (dd.sf+1),dd.x1.toFixed(4),dd.x2.toFixed(4),dd.x3.toFixed(4)].concat(UCJUMPSTAND(d,dd.i)); })
      .enter().append("td")
      .classed("hitbox",function(dd,ii){
        return ii==1 && d3.select(this.parentNode).datum().c5.length>0; 
      })
      .text(function(d,i){ return d; });
  G.selectAll("*").remove();  
  G1.selectAll("*").remove();
  d.f.map(function(dd){ return JUMPFRAMES[1][dd]; }).forEach(JUMPSTAGE);


  JUMP.selectAll("*").remove();
  var TABLE = JUMP.append("table").classed("FRAMES",true);
  var THEAD = TABLE.append("thead").append("tr");
  var JJTB = TABLE.append("tbody");
  var TH = ["SIDE", // "CHAR",
            "JUMP", "WAIT", "MOVE" //, "FRAMES"
            ];

  THEAD.selectAll("th").data(TH).enter().append("th").text(function(d,i){return d;});  
  var JJTR = JJTB.selectAll("tr").data(JUMPS[1].filter(function(dd){return dd.p == d.p && dd.m == d.m && dd.m2 == d.m2})).enter().append("tr").on("mouseenter",JUMPVIEW).on("click",JUMPVIEW).classed("UC",function(dd,ii){return dd.p == d.p && dd.md == d.md; ;});
  JJTR.selectAll("td").data(JUMPROW).enter().append("td").text(function(d,i){ return d; });
}

function JUMPVIEW(d,i) {
  if (d3.event != null && d3.event.type == "mouseenter" && !d3.event.shiftKey) return;

  JJ.p = d.p;
  JJ.m = d.m;
  JJ.md = d.md;
  JJ.m2 = d.m2;

  if (i>=0) {
    d3.select(this.parentNode).selectAll(".UC").classed("UC",false);
    d3.select(this).classed("UC",true);
  }

  if (JUMPHIT) {
    var hi = d.f.findIndex(function(ff,ii){ return JUMPFRAMES[1][ff].c5.length>0; });
    if (hi>-1) I1 = hi;
  }

  JJ.data = d;

  var TB = FRAMES.select("table").select("tbody");
  TB.selectAll("tr").remove();
  var TR = TB.selectAll("tr").data(d.f.map(function(dd){ return JUMPFRAMES[1][dd]; })).enter().append("tr").on("mouseenter",JUMPSTAGE1).on("click",JUMPSTAGE1).classed("UC",function(dd,ii){return ii==I1;});
  TR.selectAll("td")
      .data(function(dd,ii){ return [dd.i-1,JUMPSCRIPTS[1][dd.si].s + " " + (dd.sf+1),dd.x1.toFixed(4),dd.x2.toFixed(4),dd.x3.toFixed(4)].concat(UCJUMPSTAND(d,dd.i)); })      
      .enter().append("td")
      .classed("hitbox",function(dd,ii){
        return ii==1 && d3.select(this.parentNode).datum().c5.length>0; 
      })
      .text(function(d,i){ return d; });
  G.selectAll("*").remove();  
  G1.selectAll("*").remove();
  d.f.map(function(dd){ return JUMPFRAMES[1][dd]; }).forEach(JUMPSTAGE);


  JUMPJUMP.selectAll("*").remove();
  var TABLE = JUMPJUMP.append("table").classed("FRAMES",true);
  var THEAD = TABLE.append("thead").append("tr");
  var JJTB = TABLE.append("tbody");
  var TH = ["SIDE", // "CHAR",
            "JUMP", "WAIT", "MOVE" //, "FRAMES"
            ];

  THEAD.selectAll("th").data(TH).enter().append("th").text(function(d,i){return d;});  
  var JJTR = JJTB.selectAll("tr").data(JUMPS[1].filter(function(dd){return dd.md == d.md; })).enter().append("tr").classed("UC1",function(d){return d.m2=="5T";}).on("mouseenter",JUMPJUMPVIEW).on("click",JUMPJUMPVIEW).classed("UC",function(dd,ii){ return dd.p == d.p && dd.m == d.m && dd.m2 == d.m2; });
  JJTR.selectAll("td").data(JUMPROW).enter().append("td").text(function(d,i){ return d; });

}
function JUMPSTAGE(d,i) {
  if (d3.event != null && d3.event.type == "mouseenter" && !d3.event.shiftKey) return;
  
  d.c6.forEach(function(c){
    G.append("rect").attr("x",c.rx).attr("y",-c.ry-c.rh).attr("width",c.rw).attr("height",c.rh).classed((c.t&0x4)==0x4 ? "GRAB" : (c.t&0x2)==0x0 ? "PROJINV" : "HURT",true);
  });

  d.c5.forEach(function(c){
    if (c.t != 3 && c.t !=4) G.append("rect").attr("x",c.rx).attr("y",-c.ry-c.rh).attr("width",c.rw).attr("height",c.rh).classed("HIT",true);
  });

  if (//i == 0 || 
    i == I1 
    //|| d.s == "STAND" && d.sf == 0
    ) JUMPSTAGE1(d);
}
function JUMPSTAGE1(d,i) {
  if (d3.event != null && d3.event.type == "mouseenter" && !d3.event.shiftKey) return;

  if (i!=null) { I1 = i; G1.selectAll("*").remove(); }

  d.c6.forEach(function(c){
    G1.append("rect").attr("x",c.rx).attr("y",-c.ry-c.rh).attr("width",c.rw).attr("height",c.rh).classed((c.t&0x4)==0x4 ? "GRAB" : (c.t&0x2)==0x0 ? "PROJINV" : "HURT",true);
  });

  d.c5.forEach(function(c){
    if (c.t != 3 && c.t !=4) G1.append("rect").attr("x",c.rx).attr("y",-c.ry-c.rh).attr("width",c.rw).attr("height",c.rh).classed("HIT",true);
  });

  if (i==null) return;
  d3.select(this.parentNode).selectAll(".UC").classed("UC",false);
  d3.select(this).classed("UC",true);
}


function STANDVIEW(d,i) {
  if (d3.event != null && d3.event.type == "mouseenter" && !d3.event.shiftKey && !d3.event.shiftKey && i>=0) return;

  if (i>=-1){
    SS.p = d.p;
    SS.m = d.m;
  }

  if (i>=0) {
    d3.select(this.parentNode).selectAll(".UC").classed("UC",false);
    d3.select(this).classed("UC",true);
  }

  if (STANDHIT) {
    var hi = d.f.findIndex(function(ff,ii){ return ff.c5.length>0; });
    if (hi>-1) I2 = hi;
  }
  
  SS.data = d;

  var TB = FRAMES2.select("table").select("tbody");
  TB.selectAll("tr").remove();
  var TR = TB.selectAll("tr").data(d.f).enter().append("tr").on("mouseenter",STANDSTAGE1).on("click",STANDSTAGE1).classed("UC",function(dd,ii){return ii==I2;});
  TR.selectAll("td")
      .data(function(dd,ii){ return [dd.i-1,dd.s + " " + (dd.sf+1) + (dd.sf==dd.s1?" IASA":dd.sf>dd.s1?" +":""),dd.x1.toFixed(4),dd.x2.toFixed(4),dd.x3.toFixed(4), (dd.c5.length>0?(dd.c5[0].i & 0x7).toString(16):"")]; })
      .enter().append("td")
      .classed("hitbox",function(dd,ii){
        return ii==1 && d3.select(this.parentNode).datum().c5.length>0; 
      })
      .classed("iasa1",function(dd,ii){
        return ii==1 && dd.endsWith(" +"); 
      })
      .text(function(d,i){ return d; });
  GG.selectAll("*").remove();  
  GG1.selectAll("*").remove();
  d.f.forEach(STANDSTAGE);

  if (JJ.data != null) JUMPVIEW(JJ.data,-1);

}
function STANDSTAGE(d,i) {
  if (d3.event != null && d3.event.type == "mouseenter" && !d3.event.shiftKey) return;

  d.c6.forEach(function(c){
    GG.append("rect").attr("x",c.rx).attr("y",-c.ry-c.rh).attr("width",c.rw).attr("height",c.rh).classed((c.t&0x4)==0x4 ? "GRAB" : (c.t&0x2)==0x0 ? "PROJINV" : "HURT",true);
  });

  d.c5.forEach(function(c){
    if (c.t != 3 && c.t !=4) GG.append("rect").attr("x",c.rx).attr("y",-c.ry-c.rh).attr("width",c.rw).attr("height",c.rh).classed("HIT",true);
  });

  if (//i == 0 || 
    i == I2 
    //|| d.s == "STAND" && d.sf == 0
    ) STANDSTAGE1(d);
}
function STANDSTAGE1(d,i) {  
  if (d3.event != null && d3.event.type == "mouseenter" && !d3.event.shiftKey) return;

  if (i!=null) { I2 = i; GG1.selectAll("*").remove(); }

  d.c6.forEach(function(c){
    GG1.append("rect").attr("x",c.rx).attr("y",-c.ry-c.rh).attr("width",c.rw).attr("height",c.rh).classed((c.t&0x4)==0x4 ? "GRAB" : (c.t&0x2)==0x0 ? "PROJINV" : "HURT",true);
  });

  d.c5.forEach(function(c){
    if (c.t != 3 && c.t !=4) GG1.append("rect").attr("x",c.rx).attr("y",-c.ry-c.rh).attr("width",c.rw).attr("height",c.rh).classed("HIT",true);
  });

  if (i==null) return;
  d3.select(this.parentNode).selectAll(".UC").classed("UC",false);
  d3.select(this).classed("UC",true);
}

function UCJUMP(data) {
  JUMPS[1] = data.r;//JSON.parse(data);
  JUMPSCRIPTS[1] = data.s;//JSON.parse(data);
  JUMPFRAMES[1] = data.f;//JSON.parse(data);

  JUMPJUMP.selectAll("*").remove();
  var TABLE = JUMPJUMP.append("table").classed("FRAMES",true);
  var THEAD = TABLE.append("thead").append("tr");
  var JJTB = TABLE.append("tbody");
  var TH = ["SIDE", // "CHAR",
            "JUMP", "WAIT", "MOVE" //, "FRAMES"
            ];

  THEAD.selectAll("th").data(TH).enter().append("th").text(function(d,i){return d;});  
  var JJTR = JJTB.selectAll("tr").data(JUMPS[1].filter(function(dd){return dd.md == JJ.md; })).enter().append("tr")
    .classed("UC1",function(d){return d.m2=="5T"})
    .classed("UC",function(d){ return d.p == JJ.p && d.m == JJ.m && d.md == JJ.md && d.m2 == JJ.m2; })
    .on("mouseenter",JUMPJUMPVIEW).on("click",JUMPJUMPVIEW);
  JJTR.selectAll("td").data(JUMPROW).enter().append("td").text(function(d,i){ return d; });

  var i = JUMPS[1].findIndex(function(ff,ii){ return ff.p == JJ.p && ff.m == JJ.m  && ff.md == JJ.md  && ff.m2 == JJ.m2; });
  if (i>=0) JUMPJUMPVIEW(JUMPS[1][i],-1);
}

function UCSTAND(data) {
  JUMPS[2] = data;

  var TABLE = STAND.append("table").classed("FRAMES",true);
  var THEAD = TABLE.append("thead").append("tr");
  var TB = TABLE.append("tbody");
  var TH = ["SIDE", // "CHAR",
            "STAND", "START", "IASA" //, "FRAMES"
            ];

  THEAD.selectAll("th").data(TH).enter().append("th").text(function(d,i){return d;});  
  var TR = TB.selectAll("tr").data(JUMPS[2]).enter().append("tr")
    .classed("UC1",function(d){return d.m=="5S" || d.m.endsWith("LP");})
    .classed("UC",function(d){ return d.p == SS.p && d.m == SS.m; })    
    .on("mouseenter",STANDVIEW).on("click",STANDVIEW);
  TR.selectAll("td").data(STANDROW).enter().append("td").text(function(d,i){ return d; });

  var i = JUMPS[2].findIndex(function(ff,ii){ return ff.p == SS.p && ff.m == SS.m; });
  if (i>=0) STANDVIEW(JUMPS[2][i],-1);
  else {
    i = JUMPS[2].findIndex(function(ff,ii){ return ff.p == SS.p && ff.m == "5S"; });
    if (i>=0) STANDVIEW(JUMPS[2][i],-2);
  }
}

function UCSTANDALL(STARTUP) {  

  STAND.selectAll("*").remove();
  var TABLE = STAND.append("table").classed("FRAMES",true);
  var THEAD = TABLE.append("thead").append("tr");
  var TB = TABLE.append("tbody");
  var TH = ["CHAR", // "CHAR",
            "STAND", "START", "IASA", "DIST" //, "FRAMES"
            ];

  THEAD.selectAll("th").data(TH).enter().append("th").text(function(d,i){return d;})
    .on("click",function(d,i){
        TR.sort(function(aa, bb) {
            var a = STANDALLROW(aa);
            var b = STANDALLROW(bb);
            if (d == "DIST") 
              return a[i] > b[i] ? -1 : a[i] < b[i] ? 1 : a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0; 
            else
              return a[i] < b[i] ? -1 : a[i] > b[i] ? 1 : a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0; 
          });
      });

  JUMPS[2] = [];

  STANDZIPS.forEach(function(d,i){
    if (d.data==null) return;   

    d.data.forEach(function(dd,ii){
      var START = dd.f.findIndex(function(ff,ii){ return ff.c5.length>0 && (ff.c5[0].i & 0x3)==0; })-1;
      dd.c = d.zip;
      if (START == STARTUP) JUMPS[2].push(dd);
    });

  });

  var TR = TB.selectAll("tr").data(JUMPS[2]).enter().append("tr").on("mouseenter",STANDVIEW).on("click",STANDVIEW);
  TR.selectAll("td").data(STANDALLROW).enter().append("td").text(function(d,i){ return d; });

}

var JUMPZIPS = [
  {"data":null,"zip":"JUMP_ALX"},
  {"data":null,"zip":"JUMP_BLR"},
  {"data":null,"zip":"JUMP_BLR2"},
  {"data":null,"zip":"JUMP_BRD"},
  {"data":null,"zip":"JUMP_BRD2"},
  {"data":null,"zip":"JUMP_BSN"},
  {"data":null,"zip":"JUMP_CMY"},
  {"data":null,"zip":"JUMP_CNL"},
  {"data":null,"zip":"JUMP_CNL2"},
  {"data":null,"zip":"JUMP_DSM"},
  {"data":null,"zip":"JUMP_FAN"},
  {"data":null,"zip":"JUMP_GUL"},
  {"data":null,"zip":"JUMP_IBK"},
  {"data":null,"zip":"JUMP_JRI"},
  {"data":null,"zip":"JUMP_KEN"},
  {"data":null,"zip":"JUMP_KRN"},
  {"data":null,"zip":"JUMP_LAR"},
  {"data":null,"zip":"JUMP_NCL"},
  {"data":null,"zip":"JUMP_NCL2"},
  {"data":null,"zip":"JUMP_NSH"},
  {"data":null,"zip":"JUMP_RMK"},
  {"data":null,"zip":"JUMP_RSD"},
  {"data":null,"zip":"JUMP_RYU"},
  {"data":null,"zip":"JUMP_RYU2"},
  {"data":null,"zip":"JUMP_VEG"},
  {"data":null,"zip":"JUMP_VEG2"},
  {"data":null,"zip":"JUMP_ZGF"},
  ];

var STANDZIPS = [
  {"data":null,"zip":"ALX"},
  {"data":null,"zip":"BLR"},
  {"data":null,"zip":"BLR2"},
  {"data":null,"zip":"BRD"},
  {"data":null,"zip":"BRD2"},
  {"data":null,"zip":"BSN"},
  {"data":null,"zip":"CMY"},
  {"data":null,"zip":"CNL"},
  {"data":null,"zip":"CNL2"},
  {"data":null,"zip":"DSM"},
  {"data":null,"zip":"FAN"},
  {"data":null,"zip":"GUL"},
  {"data":null,"zip":"IBK"},
  {"data":null,"zip":"JRI"},
  {"data":null,"zip":"JRI2"},
  {"data":null,"zip":"KEN"},
  {"data":null,"zip":"KRN"},
  {"data":null,"zip":"LAR"},
  {"data":null,"zip":"NCL"},
  {"data":null,"zip":"NCL2"},
  {"data":null,"zip":"NSH"},
  {"data":null,"zip":"RMK"},
  {"data":null,"zip":"RSD"},
  {"data":null,"zip":"RYU"},
  {"data":null,"zip":"RYU2"},
  {"data":null,"zip":"VEG"},
  {"data":null,"zip":"VEG2"},
  {"data":null,"zip":"ZGF"},
  ];

var ZIP = new JSZip();
var ZIP1 = new JSZip();

function ALLJUMP() {

  JUMPZIPS.forEach(function(d,i){
    if (d.data==null) {
      // JSZipUtils.getBinaryContent(d.zip+".zip", function(err, data) {
      //   if(err) { throw err; }
        
        // var zip = new JSZip();
        // d.data = zip;
        // zip.loadAsync(data).then(function () {          
          // zip.file(d.zip+".json").async("string")
          ZIP.file(d.zip+".json").async("string")
              //.then(function(data){ d.data=data; d3.select("#ALLLOAD").text("" + JUMPZIPS.filter(function(d){return d.data!=null;}).length  + " / " + JUMPZIPS.length); });
              // .then(function(data){ d3.select("#ALLLOAD").text("" + JUMPZIPS.filter(function(d){return d.data!=null;}).length  + " / " + JUMPZIPS.length); });
              .then(function(data){ d.data = JSON.parse(data); d3.select("#ALLLOAD").text("" + JUMPZIPS.filter(function(d){return d.data!=null;}).length  + " / " + JUMPZIPS.length); });
        // });
      // });
    }
  });


  JUMPZIP.select("tbody").selectAll("tr").classed("UC0",false);

  STANDZIPS.forEach(function(d,i){
    if (d.data==null) {
      LOADSTANDZIP(d);
    }
  });

  //d3.select(this).classed("UC",false);

  // JSZipUtils.getBinaryContent("JUMP.zip", function(err, data) {
  //   if(err) { throw err; }
  //   ZIP.loadAsync(data).then(function () {
  //     JUMPZIPS.forEach(function(d,i){
  //       if (d.data==null) {
  //         ZIP.file(d.zip+".json").async("string")
  //           //.then(function(data){console.log(d.zip); d.data=JSON.parse(data);});
  //           .then(function(data){ d.data=data; });
  //       }
  //     });
  //   });
  // });  
}

function ALLSTAND() {

  STANDZIPS.forEach(function(d,i){
    if (d.data==null) {
      LOADSTANDZIP(d).then(function(data){ 
          d3.select("#ALLLOADSTAND").text("" + STANDZIPS.filter(function(d){return d.data!=null;}).length  + " / " + STANDZIPS.length); 
          d3.selectAll(".ALLLOADSTAND").text("" + STANDZIPS.filter(function(d){return d.data!=null;}).length); 
        });
    }
  });
}



function UCJUMPZIP(d,i) {

  if (d.data != null) {
    if (d3.event != null && d3.event.type == "mouseenter" && !d3.event.shiftKey) return;    
    d3.select(this.parentNode).selectAll(".UC").classed("UC",false);
    d3.select(this).classed("UC",true);
    UCJUMP(d.data);
    // UCJUMP(JSON.parse(d.data));
    //d.data.file(d.zip+".json").async("string").then(function(data){ UCJUMP(JSON.parse(data)); });
    return;
  }

  if (d3.event != null && d3.event.type == "mouseenter") return;

  d3.select(this.parentNode).selectAll(".UC").classed("UC",false);
  d3.select(this).classed("UC",true);
  d3.select(this).classed("UC0",true);

  JUMPJUMP.selectAll("*").remove();
  var TABLE = JUMPJUMP.append("table").classed("FRAMES",true);
  var THEAD = TABLE.append("thead").append("tr");
  var JJTB = TABLE.append("tbody");
  var TH = ["SIDE", // "CHAR",
            "JUMP", "WAIT", "MOVE" //, "FRAMES"
            ];

  THEAD.selectAll("th").data(TH).enter().append("th").text(function(d,i){return d;});  
  var TR = JJTB.append("tr");
  TR.append("td").text("");
  TR.append("td").text("LOADING...");
  var JJUNZIP = TR.append("td").attr("id","JJUNZIP");
  
  JUMP.selectAll("*").remove();
  FRAMES.select("table").select("tbody").selectAll("tr").remove();

  // JSZipUtils.getBinaryContent(d.zip+".zip", function(err, data) {
  //    if(err) { throw err; }
      //d.data = new JSZip();
      //d.data.loadAsync(data).then(function () {
      // ZIP.loadAsync(data).then(function () {
          ZIP.file(d.zip+".json").async("string")
          // d.data.file(d.zip+".json").async("string")
          .then(function(data){ d.data = JSON.parse(data); UCJUMP(d.data); d3.select("#ALLLOAD").text("" + JUMPZIPS.filter(function(d){return d.data!=null;}).length  + " / " + JUMPZIPS.length); });
          // d.data.file(d.zip+".json").async("string")
            // .then(function(data){UCJUMP(JSON.parse(data));});
            // .then(function(data){d.data=data; UCJUMP(JSON.parse(d.data)); d3.select("#ALLLOAD").text("" + JUMPZIPS.filter(function(d){return d.data!=null;}).length  + " / " + JUMPZIPS.length); });
            // .then(function(data){d.data=JSON.parse(data); UCJUMP(d.data);});          
      // });
  // });
}


function UCSTANDZIP(dd,i) {

  if (d3.event != null && d3.event.type == "mouseenter" && !d3.event.shiftKey && i>=0) return;

  d3.select(this.parentNode.parentNode).selectAll(".UC").classed("UC",false);
  d3.select(this).classed("UC",true);

  STAND.selectAll("*").remove();
  FRAMES2.select("table").select("tbody").selectAll("tr").remove();

  if (dd.data != null) {
    UCSTAND(dd.data);
    return;
  }

  LOADSTANDZIP(dd).then(function(data){ 
      UCSTAND(dd.data); 
      d3.select("#ALLLOADSTAND").text("" + STANDZIPS.filter(function(d){return d.data!=null;}).length  + " / " + STANDZIPS.length);
      d3.selectAll(".ALLLOADSTAND").text("" + STANDZIPS.filter(function(d){return d.data!=null;}).length); 
    });
  // ZIP1.file(d).async("string").then(UCSTAND);
}


function LOADSTANDZIP(dd) {
  return ZIP1.file("LOL_" + dd.zip + "_" + dd.zip + ".json").async("string").then(function(data){
    dd.data = [];
    var MOVES = [[],[]];
    JSON.parse(data).forEach(function(d,i){
      if (MOVES[d.p][d.f[3].s] === undefined) {
        MOVES[d.p][d.f[3].s] = 1;
        if (d.p==1) {
          d.f.forEach(function(f){
            f.c5 = f.c5.filter(function(c){return c.t!=4&&c.t!=3;})
          });
          dd.data.push(d);
        }
      } else {
        MOVES[d.p][d.f[3].s]++;
      }
    });
  });
}


JSZipUtils.getBinaryContent("LOL.zip", function(err, data) {
    if(err) { throw err; }
    d3.select("#ALLLOADSTAND").text("0 / " + STANDZIPS.length);

    ZIP1.loadAsync(data).then(function () {      
      var TB = STANDZIP.select("table").select("tbody");
      TB.selectAll("tr").remove();      
      var TR = TB.selectAll("tr").data(STANDZIPS).enter().append("tr").on("click",UCSTANDZIP).on("mouseenter",UCSTANDZIP);
      // var TR = TB.selectAll("tr").data(Object.keys(ZIP1.files).sort(function(a,b){return a.split("_")[1] > b.split("_")[1] ? 1 : -1;})).enter().append("tr").on("click",UCSTANDZIP).on("mouseenter",UCSTANDZIP);
      TR.selectAll("td").data(function(d,i){ return [i+1,d.zip]; }).enter().append("td").text(function(d,i){ return d; });

      // ZIP1.file("LOL_BSN_BSN.json").async("string").then(UCSTAND);

      TR = TB.append("tr");
      TR.append("td").html("&nbsp;");
      TR.append("td").html("&nbsp;");

      var TH = STANDZIP.select("table").append("thead");
      TR = TH.append("tr").datum(2.0);
      TR.append("td").text("X");
      var P2X = TR.append("td").text("2.0").attr("id","P2X");

      function UCP2X() {
        P2X.text(P2X.datum().toFixed(1));
        var X = P2X.datum() - 2.0;
        GG.attr("transform","translate(" + X.toFixed(1) + " 0)");
        GG1.attr("transform","translate(" + X.toFixed(1) + " 0)");
        SS.x = X;
        if (JJ.data != null) JUMPVIEW(JJ.data,-1);
      }

      TB = STANDZIP.select("table").append("tbody");

      TR = TB.append("tr").on("click", function(d,i){ P2X.datum(P2X.datum()-1.0); UCP2X(); });
      TR.append("td").text("<<");
      TR.append("td").text("-1.0");

      TR = TB.append("tr").on("click", function(d,i){ P2X.datum(P2X.datum()+1.0); UCP2X(); });
      TR.append("td").text(">>");
      TR.append("td").text("+1.0");

      TR = TB.append("tr");
      TR.append("td").html("&nbsp;");
      TR.append("td").html("&nbsp;");

      TR = TB.append("tr").on("click", function(d,i){ P2X.datum(P2X.datum()-0.1); UCP2X(); });
      TR.append("td").text("<");
      TR.append("td").text("-0.1");
      TR = TB.append("tr").on("click", function(d,i){ P2X.datum(P2X.datum()+0.1); UCP2X(); });
      TR.append("td").text(">");
      TR.append("td").text("+0.1");

      TR = TB.append("tr");
      TR.append("td").html("&nbsp;");
      TR.append("td").html("&nbsp;");

      TR = TB.selectAll("tr.X").data([0.0, 0.5, 1.0, 1.5, 2.0, 2.5]).enter().append("tr")
                    .on("click", function(d,i){ P2X.datum(d); UCP2X(); })
                    .on("mouseenter", function(d,i){ if (!d3.event.shiftKey) return; P2X.datum(d); UCP2X(); });
      TR.selectAll("td").data(function(d,i){ return ["X",d.toFixed(1)]; }).enter().append("td").text(function(d,i){ return d; });

      TR = TB.append("tr");
      TR.append("td").html("&nbsp;");
      TR.append("td").html("&nbsp;");

      TH = STANDZIP.select("table").append("thead");
      TR = TH.append("tr").datum(2.0);
      TR.append("td").text("#");
      TR.append("td").text("ALL");

      TB = STANDZIP.select("table").append("tbody");

      TR = TB.append("tr").on("click", function(d,i){ 
                d3.select(this.parentNode.parentNode).selectAll(".UC").classed("UC",false);
                d3.select(this).classed("UC",true); 
                UCSTANDALL(3); 
              });
      TR.append("td").text("0").classed("ALLLOADSTAND", true);
      TR.append("td").text("3F");

      TR = TB.append("tr").on("click", function(d,i){ 
                d3.select(this.parentNode.parentNode).selectAll(".UC").classed("UC",false);
                d3.select(this).classed("UC",true); 
                UCSTANDALL(4); 
              });
      TR.append("td").text("0").classed("ALLLOADSTAND", true);
      TR.append("td").text("4F");
      
    });
});

function UCJUMPZIPS() {
  var TB = JUMPZIP.select("table").select("tbody");
  TB.selectAll("tr").remove();
  var TR = TB.selectAll("tr").data(JUMPZIPS).enter().append("tr").on("click",UCJUMPZIP).on("mouseenter",UCJUMPZIP);
  TR.selectAll("td").data(function(d,i){ return [i+1,d.zip]; }).enter().append("td").text(function(d,i){ return d; });
}

// UCJUMPZIPS();


JSZipUtils.getBinaryContent("JUMP.zip", function(err, data) {
    if(err) { throw err; }
    // d3.select("#LOADJUMP").text("LOAD");
    d3.select("#ALLLOAD").text("0 / " + JUMPZIPS.length);
    ZIP.loadAsync(data).then(function () {
      var TB = JUMPZIP.select("table").select("tbody");
      TB.selectAll("tr").remove();
      //  var TR = TB.selectAll("tr").data(Object.keys(ZIP.files).sort(function(a,b){return a.split(".")[0] > b.split(".")[0] ? 1 : -1;})).enter().append("tr").on("click",UCJUMPZIP);
      // TR.selectAll("td").data(function(d,i){ return [i+1,d.split(".")[0]]; }).enter().append("td").text(function(d,i){ return d; });
      var TR = TB.selectAll("tr").data(JUMPZIPS).enter().append("tr").on("click",UCJUMPZIP).on("mouseenter",UCJUMPZIP);
      TR.selectAll("td").data(function(d,i){ return [i+1,d.zip]; }).enter().append("td").text(function(d,i){ return d; });

      // ZIP.file("JUMP_RYU.json").async("string").then(UCJUMP);
    });
});

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72771119-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>